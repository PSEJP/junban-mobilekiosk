<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/neon-animation/neon-shared-element-animatable-behavior.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="junban-mobilekiosk-sign">
    <template>
        <style>
            :host {
                position: fixed;
                top: 0px;
                right: 0px;
                bottom: 0px;
                left: 0px;
                outline: 1px solid red;
            }
            #container {
                position: relative;
                height: 100%;
                width: 100%;
            }

            #fixed {
                position: fixed;
                top: 0px;
                right: 0px;
                bottom: 0px;
                left: 0px;
                height: 100%;
                width: 100%;
                background-color: orange;
                will-change: transform;
            }

            #toucharea {
                position: absolute;
                top: 6px;
                right: 6px;
                bottom: 6px;
                left: 6px;
                background-color: white;
                outline: 1px dashed red;
                will-change: transform;
            }

            #clearBtn {
                position: absolute;
                left: 10px;
                bottom: 20px;
                z-index: 99999;
                outline: var(--paper-grey-200) 1px solid;
                will-change: transform;
            }

            #submitBtn {
                position: absolute;
                right: 10px;
                bottom: 20px;
                z-index: 99999;
                background-color: var(--paper-green-500);
                color: white;
                will-change: transform;
            }

            /* not fully support*/
            @viewport {
                orientation: portrait;
            }

            /* For portrait, we want the sign area keep landscape view */

            @media screen and (orientation: portrait) {

                #toucharea:before {
                    position: absolute;
                    left:0; top:0;
                    content:'portrait';
                }

                #container {
                    transform: rotate(90deg);
                    transform-origin: 50vw 50vw;
                    height: 100vw;
                    width: 100vh;
                }
            }

            /* For landscape, we want the sign area work as normal*/

            @media screen and (orientation: landscape) {
                #toucharea:before {
                    position: absolute;
                    left:0; top:0;
                    content:'landscape';
                }
            }
        </style>
        <!-- TODO:要解決的問題
            *) 簽名模式要強制 landscape mode
            *) 簽名時 chrome 在瀏覽器上部向下滑動會跑出重整泡泡
        -->

        <div id="fixed"></div>
        <div id="container">
            <div id="toucharea"></div>
            <paper-button id="clearBtn" on-tap="_clearTap">Refresh</paper-button>
            <paper-button id="submitBtn" on-tap="_submitTap">Submit</paper-button>
        </div>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                is: 'junban-mobilekiosk-sign',

                behaviors: [
                    Polymer.NeonSharedElementAnimatableBehavior
                ],

                properties: {
                    data: {
                        type: Array,
                        value: []
                    },

                    sharedElements: {
                        type: Object,
                        value: function () {
                            return {
                                'ripple': this.$.fixed
                            }
                        }
                    },

                    animationConfig: {
                        type: Object,
                        value: function () {
                            return {
                                'entry': [{
                                    name: 'ripple-animation',
                                    id: 'ripple',
                                    toPage: this
                                }, {
                                    name: 'transform-animation',
                                    transformFrom: 'translateY(150vh)',
                                    transformTo: 'translateY(0vh)',
                                    node: this.$.toucharea,
                                    timing: {
                                        delay: 350
                                    }
                                },
                                    {
                                        name: 'cascaded-animation',
                                        animation: 'transform-animation',
                                        transformFrom: 'translateY(60vh)',
                                        nodes: [this.$.submitBtn, this.$.clearBtn],
                                        timing: {
                                            delay: 500
                                        }
                                    }],
                                'exit': [{
                                    name: 'fade-out-animation',
                                    node: this.$.fixed,
                                    timing: {
                                        delay: 350
                                    }
                                }, {
                                    name: 'transform-animation',
                                    transformFrom: 'none',
                                    transformTo: 'translate(0px,-200vh) scale(0.9,1)',
                                    node: this.$.toucharea
                                },
                                    {
                                        name: 'cascaded-animation',
                                        animation: 'transform-animation',
                                        transformTo: 'translateY(60vh)',
                                        nodes: [this.$.submitBtn, this.$.clearBtn],
                                    }]
                            }
                        }
                    }
                },
                _submitTap: function () {
                    this.fire('close-toucharea');
                    this.set('data.sign.complete', true )
                },
                _clearTap: function () {
                }
            });
        })();
    </script>
</dom-module>
